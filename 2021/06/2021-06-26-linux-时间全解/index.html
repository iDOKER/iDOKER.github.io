<!DOCTYPE html>
<html lang="zh">
  <head>
    <title>
        Linux 时间全解 - Stan&#39;s blog - Explore the world
      </title>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    
    <meta name="theme-color" content="#000000" />
    
    <meta http-equiv="window-target" content="_top" />
    
    
    <meta name="description" content="👌 2021-06-26 Linux 时间全解 FileInfo Filename - Linux 时间全解 Version - v1.1.2107（2021/06/26 ~ 2021/07/01） Author - nuo standuke Email - shadowdoker@gmail.com DescriptionKey - Linux time solution 版本修订记录： v1" />
    <meta name="generator" content="Hugo 0.82.1 with theme pure" />
    <title>Linux 时间全解 - Stan&#39;s blog - Explore the world</title>
    
    
    <link rel="stylesheet" href="https://blog.standuke.top/css/style.min.6f90022f237877ae2514ec95f3c9cca9f2314394f20800ca037a497e20053122.css">
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/9.15.10/styles/github.min.css" async>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css" async>
    <meta property="og:title" content="Linux 时间全解" />
<meta property="og:description" content="👌 2021-06-26 Linux 时间全解 FileInfo Filename - Linux 时间全解 Version - v1.1.2107（2021/06/26 ~ 2021/07/01） Author - nuo standuke Email - shadowdoker@gmail.com DescriptionKey - Linux time solution 版本修订记录： v1" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.standuke.top/2021/06/2021-06-26-linux-%E6%97%B6%E9%97%B4%E5%85%A8%E8%A7%A3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-26T11:11:31&#43;08:00" />
<meta property="article:modified_time" content="2021-06-26T11:11:31&#43;08:00" />

<meta itemprop="name" content="Linux 时间全解">
<meta itemprop="description" content="👌 2021-06-26 Linux 时间全解 FileInfo Filename - Linux 时间全解 Version - v1.1.2107（2021/06/26 ~ 2021/07/01） Author - nuo standuke Email - shadowdoker@gmail.com DescriptionKey - Linux time solution 版本修订记录： v1"><meta itemprop="datePublished" content="2021-06-26T11:11:31&#43;08:00" />
<meta itemprop="dateModified" content="2021-06-26T11:11:31&#43;08:00" />
<meta itemprop="wordCount" content="3446">
<meta itemprop="keywords" content="Linux,CentOS," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Linux 时间全解"/>
<meta name="twitter:description" content="👌 2021-06-26 Linux 时间全解 FileInfo Filename - Linux 时间全解 Version - v1.1.2107（2021/06/26 ~ 2021/07/01） Author - nuo standuke Email - shadowdoker@gmail.com DescriptionKey - Linux time solution 版本修订记录： v1"/>

    <!--[if lte IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
      <![endif]-->

    <!--[if lt IE 9]>
        <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
      <![endif]-->
  </head>

  
  

  <body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader">
    <div class="slimContent">
      <div class="navbar-header">
        <div class="profile-block text-center">
          <a id="avatar" href="https://www.standuke.top" target="_blank">
            <img class="img-circle img-rotate" src="https://blog.standuke.top/avatar.png" width="200" height="200">
          </a>
          <h2 id="name" class="hidden-xs hidden-sm">Standuke</h2>
          <h3 id="title" class="hidden-xs hidden-sm hidden-md">Yunshen Technology Co., Ltd. - SRE Engineer</h3>
          <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i>Hangzhou, China</small>
        </div><div class="search" id="search-form-wrap">
    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i
                        class="icon icon-search"></i></button>
            </span>
        </div>
        <div class="ins-search">
            <div class="ins-search-mask"></div>
            <div class="ins-search-container">
                <div class="ins-input-wrapper">
                    <input type="text" class="ins-search-input" placeholder="想要查找什么..."
                        x-webkit-speech />
                    <button type="button" class="close ins-close ins-selectable" data-dismiss="modal"
                        aria-label="Close"><span aria-hidden="true">×</span></button>
                </div>
                <div class="ins-section-wrapper">
                    <div class="ins-section-container"></div>
                </div>
            </div>
        </div>
    </form>
</div>
        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
        <ul class="nav navbar-nav main-nav">
            <li class="menu-item menu-item-home">
                <a href="/">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title">Home</span>
                </a>
            </li>
            <li class="menu-item menu-item-archives">
                <a href="/posts/">
                    <i class="icon icon-archives-fill"></i>
                  <span class="menu-title">Archives</span>
                </a>
            </li>
            <li class="menu-item menu-item-categories">
                <a href="/categories/">
                    <i class="icon icon-folder"></i>
                  <span class="menu-title">Categories</span>
                </a>
            </li>
            <li class="menu-item menu-item-tags">
                <a href="/tags/">
                    <i class="icon icon-tags"></i>
                  <span class="menu-title">Tags</span>
                </a>
            </li>
            <li class="menu-item menu-item-about">
                <a href="/about/">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title">About</span>
                </a>
            </li>
            <li class="menu-item menu-item-linkedin">
                <a href="https://linkedin.com/in/doc-s-44435ab2">
                    <i class="icon icon-linkedin"></i>
                  <span class="menu-title">Linkedin</span>
                </a>
            </li>
        </ul>
      </nav>
    </div>
  </header>

<aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content"><p>站点迁移初期，配置参数调整，同时涉及到的文章较多，页面浏览可能会出现闪断。因为是业余时间迁移博客，从 5 月开始估计要到年底才能把前期的文章整体迁移过来。博客评论采用 Disqus 需要科学才能看到，如果有任何意见建议也可直接联系我 Telegram。</p>
            </div>
        </div>
    </div>
</div>

      <div class="widget">
    <h3 class="widget-title"> 标签</h3>
    <div id="tag-cloud-list" class="widget-body">
            
            
            <a href="https://blog.standuke.top/tags/aliyun/" class="tag-list-link" rel="1">aliyun<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/bigdata/" class="tag-list-link" rel="1">bigdata<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/cdh/" class="tag-list-link" rel="1">cdh<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/centos/" class="tag-list-link" rel="10">centos<span
               class="tag-list-count">10</span></a>
            
            
            <a href="https://blog.standuke.top/tags/cloudera/" class="tag-list-link" rel="1">cloudera<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/docker/" class="tag-list-link" rel="1">docker<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/eip/" class="tag-list-link" rel="1">eip<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/esxi/" class="tag-list-link" rel="1">esxi<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/frp/" class="tag-list-link" rel="1">frp<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/kvm/" class="tag-list-link" rel="1">kvm<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/linux/" class="tag-list-link" rel="7">linux<span
               class="tag-list-count">7</span></a>
            
            
            <a href="https://blog.standuke.top/tags/linux-bridge/" class="tag-list-link" rel="1">linux-bridge<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/macos/" class="tag-list-link" rel="2">macos<span
               class="tag-list-count">2</span></a>
            
            
            <a href="https://blog.standuke.top/tags/markdown/" class="tag-list-link" rel="1">markdown<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/network/" class="tag-list-link" rel="1">network<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/openstack/" class="tag-list-link" rel="6">openstack<span
               class="tag-list-count">6</span></a>
            
            
            <a href="https://blog.standuke.top/tags/pxe/" class="tag-list-link" rel="1">pxe<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/qcow2/" class="tag-list-link" rel="1">qcow2<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/system/" class="tag-list-link" rel="1">system<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/time-machine/" class="tag-list-link" rel="1">time-machine<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/tools/" class="tag-list-link" rel="1">tools<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/vcenter/" class="tag-list-link" rel="1">vcenter<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/virtualization/" class="tag-list-link" rel="9">virtualization<span
               class="tag-list-count">9</span></a>
            
            
            <a href="https://blog.standuke.top/tags/vsphere/" class="tag-list-link" rel="1">vsphere<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://blog.standuke.top/tags/windows/" class="tag-list-link" rel="4">windows<span
               class="tag-list-count">4</span></a>
            
    </div>
<script>
document.onreadystatechange = () => {
  if (document.readyState === 'complete') {
    tagCloud('#tag-cloud-list a',  8 ,  20 );
  }
};

function tagCloud(where, min, max) {
  let iMax = 0;
  let iMin = 0;
  $(where).each(function() {
    let weight = Number($(this).attr("rel"));
    if(iMax < weight) iMax = weight;
    if(iMin > weight || iMin == 0) iMin = weight;
  });
  let step = (max - min)/(iMax - iMin);
  $(where).each(function() {
    let weight = $(this).attr("rel") - iMin;
    $(this).css({"font-size": min + (weight * step) + 'px'});
  });
};
</script>
</div>

      <div class="widget">
    <h3 class="widget-title"> 分类</h3>
    <div class="widget-body">
        <ul class="category-list">
            <li class="category-list-item"><a href="https://blog.standuke.top/categories/%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/" class="category-list-link">使用教程</a><span class="category-list-count">3</span></li>
            <li class="category-list-item"><a href="https://blog.standuke.top/categories/%E5%86%85%E9%83%A8%E5%88%86%E4%BA%AB/" class="category-list-link">内部分享</a><span class="category-list-count">3</span></li>
            <li class="category-list-item"><a href="https://blog.standuke.top/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90/" class="category-list-link">技术分析</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://blog.standuke.top/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="category-list-link">操作系统</a><span class="category-list-count">9</span></li>
            <li class="category-list-item"><a href="https://blog.standuke.top/categories/%E9%83%A8%E7%BD%B2%E6%95%99%E7%A8%8B/" class="category-list-link">部署教程</a><span class="category-list-count">10</span></li>
            <li class="category-list-item"><a href="https://blog.standuke.top/categories/%E9%9B%B6%E7%A2%8E%E5%B0%8F%E9%97%AE%E9%A2%98/" class="category-list-link">零碎小问题</a><span class="category-list-count">4</span></li>
        </ul>
    </div>
</div>
      
<div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
        <ul class="recent-post-list list-unstyled no-thumbnail">
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://blog.standuke.top/2022/04/2022-04-06-ldap-over-tls/" class="title">LDAP over TLS「StartTLS」</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2022-04-06 22:20:17 &#43;0800 CST" itemprop="datePublished">2022-04-06</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://blog.standuke.top/2022/03/2022-03-23-ldap-%E4%BC%81%E4%B8%9A%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%88%98/" class="title">LDAP 企业部署实战 - LDAP 基础服务安装</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2022-03-23 21:58:34 &#43;0800 CST" itemprop="datePublished">2022-03-23</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://blog.standuke.top/2021/07/2021-07-06-linux-%E5%AE%9A%E6%97%B6%E5%8D%95%E6%AC%A1%E5%8F%8A%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/" class="title">Linux 定时单次及周期任务</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2021-07-06 17:20:34 &#43;0800 CST" itemprop="datePublished">2021-07-06</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://blog.standuke.top/2021/06/2021-06-26-linux-%E6%97%B6%E9%97%B4%E5%85%A8%E8%A7%A3/" class="title">Linux 时间全解</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2021-06-26 11:11:31 &#43;0800 CST" itemprop="datePublished">2021-06-26</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://blog.standuke.top/2021/05/2021-05-19-%E9%98%BF%E9%87%8C%E4%BA%91%E4%B8%BB%E6%9C%BA-eip-%E8%87%B4%E4%BD%BF-ftp-%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5/" class="title">阿里云主机 EIP 致使 FTP 无法连接</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2021-05-19 21:08:48 &#43;0800 CST" itemprop="datePublished">2021-05-19</time>
                    </p>
                </div>
            </li>
        </ul>
    </div>
</div>
  </div>
</aside>

    
    
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <h4 class="toc-title">文章目录</h4>
    <nav id="toc" class="js-toc toc">

    </nav>
  </div>
</aside>
<main class="main" role="main"><div class="content">
  <article id="-" class="article article-type-" itemscope
    itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      <h1 itemprop="name">
  <a
    class="article-title"
    href="/2021/06/2021-06-26-linux-%E6%97%B6%E9%97%B4%E5%85%A8%E8%A7%A3/"
    >Linux 时间全解</a
  >
</h1>

      <div class="article-meta">
        
<span class="article-date">
  <i class="icon icon-calendar-check"></i>&nbsp;
<a href="https://blog.standuke.top/2021/06/2021-06-26-linux-%E6%97%B6%E9%97%B4%E5%85%A8%E8%A7%A3/" class="article-date">
  <time datetime="2021-06-26 11:11:31 &#43;0800 CST" itemprop="datePublished">2021-06-26</time>
</a>
</span>
<span class="article-category">
  <i class="icon icon-folder"></i>&nbsp;
  <a class="article-category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"> 操作系统 </a>
</span>  
  <span class="article-tag">
    <i class="icon icon-tags"></i>&nbsp;
    <a class="article-tag-link" href="/tags/linux/"> Linux </a>
    <a class="article-tag-link" href="/tags/centos/"> CentOS </a>
  </span>

	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>
        <span class="post-comment"><i class="icon icon-comment"></i>&nbsp;<a href="/2021/06/2021-06-26-linux-%E6%97%B6%E9%97%B4%E5%85%A8%E8%A7%A3/#comments"
            class="article-comment-link">评论</a></span>
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 3446字</span>
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 7分 </span>
      </div>
    </div>
    <div class="article-entry marked-body js-toc-content" itemprop="articleBody">
      <h1 id="-2021-06-26-linux-时间全解">👌 2021-06-26 Linux 时间全解</h1>
<blockquote>
<p><strong>FileInfo</strong>
Filename - Linux 时间全解
Version - v1.1.2107（2021/06/26 ~ 2021/07/01）
Author - nuo standuke
Email - <a href="mailto:shadowdoker@gmail.com">shadowdoker@gmail.com</a>
DescriptionKey - Linux time solution</p>
</blockquote>
<p><strong>版本修订记录：</strong></p>
<p>v1.0.2106：2021-06-26：建立 Linux 时间全解文档，修订人：nuo
v1.1.2107：2021-07-01：新增 CentOS 与 Ubuntu 时间同步相关区别，修订人：nuo</p>
<p>[TOC]</p>
<h2 id="简介">简介</h2>
<p>作为一切皆文件的 Linux 操作系统，日志的记录、定时任务的执行，甚至些许程序的配置「MySQL」也极度依赖系统时间，故系统时间在操作系统运行时尤为重要。和 Windows 一样，Linux 也分为本地时间用于手动设置和使用 ntp 方式自动同步的远程时间。</p>
<p>⚠️ 值得注意的是，考虑到文件的生成也会获取系统时间作为文件的时间戳，建议在安装操作系统时就将主板上的硬件时间同步，或者在安装操作系统时手动将时间校准。</p>
<p>在本文中将会涉及 CentOS 如下与时间相关的命令以及与时间相关的配置文件。同时稍有提及 Ubuntu 内的差异及其配置。</p>
<ul>
<li>timedatectl</li>
<li>date</li>
<li>chrony</li>
<li>ntp / ntpdate</li>
</ul>
<h3 id="相关名词介绍">相关名词介绍</h3>
<p>了解相关时间名词有利于理解后期相关术语的讲解，此处以 CentOS 内 <code>timedatectl</code> 标准输出作为样例。</p>
<pre><code>  &gt;root ~
[vpc]# timedatectl
    Local time: 二 2021-06-29 13:45:54 CST
    Universal time: 二 2021-06-29 05:45:54 UTC
    RTC time: 二 2021-06-29 05:45:54
    Time zone: Asia/Shanghai (CST, +0800)
    NTP enabled: yes
    NTP synchronized: yes
    RTC in local TZ: no
    DST active: n/a
</code></pre>
<blockquote>
<p><strong>UTC</strong> 「Universal time: 二 2021-06-29 05:45:54 UTC」</p>
</blockquote>
<p>协调世界时「UTC - Coordinated Universal Time」。地球分为二十四时区，每个时区都有自己的当地时间。在国际无线电通信场合，为了统一起见，使用一个统一的时间，称为协调世界时「UTC - Universal Time Coordinated」。</p>
<blockquote>
<p><strong>GMT</strong></p>
</blockquote>
<p>格林尼治标准时间「Greenwich Mean Time Zone」。指位于英国伦敦郊区的皇家格林尼治天文台的标准时间，因为本初子午线被定义在通过那里的经线。「UTC 与 GMT时间基本相同」</p>
<blockquote>
<p><strong>CTS</strong> 「Local time: 二 2021-06-29 13:45:54 CST」</p>
</blockquote>
<p>中国标准时间「CST – China Standard Time」。GMT + 8 = UTC + 8 = CST</p>
<blockquote>
<p><strong>DST</strong></p>
</blockquote>
<p>夏令时，部分国家使用，在中国不使用。所以在国外服务器配置系统时间时需要注意。</p>
<blockquote>
<p><strong>RTC 硬件时间</strong> 「RTC time: 二 2021-06-29 05:45:54」</p>
</blockquote>
<p>RTC「Real-Time Clock」或 CMOS / BIOS 时间，一般在主板上靠电池供电，服务器断电后也会继续运行。仅保存日期时间数值，无法保存时区和夏令时设置。</p>
<blockquote>
<p><strong>Local time 系统时间 / 本地时间</strong> 「Local time: 二 2021-06-29 13:45:54 CST」</p>
</blockquote>
<p>服务器启动时复制 RTC 时间，之后独立运行，保存了时间、时区和夏令时设置。所以一般来说，本地的 RTC 最好保存 UTC 时间，系统时间依照操作系统内配置自己计算最终的时间。</p>
<hr>
<ul>
<li>⚠️ 硬件时间「RTC」与 本地时间「Local time」</li>
</ul>
<p>在 <code>timedatectl set-local-rtc yes</code> 设置为 yes 时，会出现警告。「这个地方鄙视一下 <strong>阿里云</strong>，也算是一个坑，阿里云主机硬件『RTC』时间没有使用国际上通用的 UTC 时间，而是采用当地时间……」</p>
<pre><code># 告警如下

Warning: The system is configured to read the RTC time in the local time zone.
        This mode can not be fully supported. It will create various problems
        with time zone changes and daylight saving time adjustments. The RTC
        time is never updated, it relies on external facilities to maintain it.
        If at all possible, use RTC in UTC by calling
        'timedatectl set-local-rtc 0'.
</code></pre>
<p>例如如果 RTC 时间与系统时间不一致，那么 MySQL 在重启或者关闭时就会报错 <code>InnoDB: Waiting for page_cleaner to finish flushing of buffer pool</code>，原因就是 <strong>系统时间与mysql缓存的时间不一致</strong>，这时就需要把系统时间改在 MySQL 正常运行的时间之后。再将 <code>timedatectl set-local-rtc no</code> 设置为 <code>no</code>。</p>
<p>所以在配置使用 <code>timedatectl</code> 去修改时间时会同时配置系统时间「例如命令 <code>date -s</code>」和硬件时间「例如命令 <code>hwclock -w</code>」，而硬件时间 RTC 的具体值是否和系统时间一致则由 <code>set-local-rtc</code> 来配置。</p>
<h3 id="时间配置命令">时间配置命令</h3>
<h4 id="timedatectl">timedatectl</h4>
<h5 id="简介-1">简介</h5>
<p>在名词介绍部分已经稍有提及 <code>timedatectl</code> 命令，其中的概念很关键，务必要看。</p>
<p><code>timedatectl</code> 是 <code>systemd-timedated.service</code> 系统服务的命令行客户端，是在 RHEL7 及 CentOS7 中新增的 systemd 的一部分，用于系统时间管理。在 CentOS 7 系统上，建议使用 <code>timedatectl</code> 而不是 <code>date</code>、<code>hwclock</code> 命令来调整时间。在 Ubuntu 系统上，也采用 <code>timedatectl</code> 来管理时间，但是在 Ubuntu 系统上时间的管理流程稍有不同。</p>
<p>在最新的 Ubuntu 版本中，timedatectl 替代了老旧的 ntpdate。默认情况下，timedatectl 在系统启动的时候会立刻同步时间，并在稍后网络连接激活后通过 socket 再次检查一次。如果已安装了 ntpdate / ntp，timedatectl 会退而让你使用之前的设置。这样确保了两个时间同步服务不会相互冲突，同时在你升级的时候还保留原本的行为和配置。但这也意味着从旧版本的发行版升级时ntp/ntpdate 仍会安装，因此会导致新的基于 systemd 的时间服务被禁用。</p>
<p>在最新的 Ubuntu 版本中，timesyncd 替代了 ntpd 的客户端的部分。默认情况下 timesyncd 会定期检测并同步时间。它还会在本地存储更新的时间，以便在系统重启时做时间单步调整。通过 timedatectl 和 timesyncd 设置的当前时间状态和时间配置，可以使用 timedatectl status命令来进行确认。而在 CentOS 7 中，不存在 timesyncd 服务，是由 chrony 来作为 ntpd 的客户端的部分。</p>
<ul>
<li>CentOS 7.0 +</li>
</ul>
<p><code>timedatectl</code> -&gt; <code>systemd-timedated.service</code> -&gt; <code>chronyd.service</code> 「配置文件 <code>/etc/chrony.conf</code>」</p>
<ul>
<li>Ubuntu 16.04 LTS + <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></li>
</ul>
<p><code>timedatectl</code> -&gt; <code>systemd-timedated.service</code> -&gt; <code>timesyncd.service</code> 「配置文件 <code>/etc/systemd/timesyncd.conf</code>」</p>
<p><code>timedatectl</code> 能做到：修改系统时间、修改 RTC 时间、修改系统时区、设置 NTP 时间同步、查看当前系统时间状态。一般来说使用 <code>timedatectl</code> 已经能满足日常对于时间操作的需求了。</p>
<h5 id="时间同步配置">时间同步配置</h5>
<p>对于时间、时区修改较为简单，这里着重介绍下 <code>timedatectl</code> 内的 NTP 相关原理以及配置。</p>
<ul>
<li>timedatectl 的 NTP 同步流程</li>
</ul>
<p>使用 <code>timedatectl</code> 配置 NTP 客户端服务打开，<code>systemd-timedated.service</code> 收到 NTP 打开的信息，由 <code>systemd-timedated.service</code> 打开 <code>chronyd.service</code> 来启动 NTP，用于连接 服务端。<code>timedatectl</code> 内的 NTP 只能实现 NTP 的客户端角色，同时同步策略也较为激进「时间相差大则直接修改，相差小则慢慢追赶」，比较适合频繁启动的业务场景。</p>
<ul>
<li>开启 timedatectl 的 NTP 同步</li>
</ul>
<p>开启 timedatectl 的 NTP 同步需要系统安装 NTP 客户端「ntpd 或者 chrony，Ubuntu 还可以安装 timesyncd」，否则会有 <code>Failed to set ntp: NTP not supported.</code> 的报错。</p>
<pre><code>timedatectl set-ntp true
</code></pre>
<p>修改配置为开启状态，再使用 <code>timedatectl</code> 查看 <code>NTP enabled</code>、<code>NTP synchronized</code> 同步状态即可。如果没有安装 chrony 等同步软件，可参考如下注意事项的 <code>timedatectl</code> 输出。</p>
<h5 id="注意事项">注意事项</h5>
<p>⚠️ 手动安装操作系统时，会提示是否打开 NTP 时钟同步，如果选择打开那么会默认安装 <code>chrony</code> 相关软件用于系统时间同步，如果不打开，则不会安装 <code>chrony</code>，如此系统时间将不会同步。</p>
<ul>
<li>安装系统时，不开启 NTP，timedatectl 的输出，也就是没有 NTP 客户端的情况。</li>
</ul>
<pre><code>  &gt;root ~
[node1]# timedatectl
Local time: 六 2021-06-26 10:53:42 CST
Universal time: 六 2021-06-26 02:53:42 UTC
RTC time: 六 2021-06-26 10:53:26
Time zone: Asia/Shanghai (CST, +0800)
NTP enabled: n/a
NTP synchronized: no
RTC in local TZ: no
DST active: n/a
</code></pre>
<ul>
<li>安装系统时，开启 NTP，timedatectl 的输出</li>
</ul>
<pre><code>  &gt;root ~
[node1]# timedatectl
Local time: 六 2021-06-26 11:15:36 CST
Universal time: 六 2021-06-26 03:15:36 UTC
RTC time: 六 2021-06-26 03:15:36
Time zone: Asia/Shanghai (CST, +0800)
NTP enabled: yes
NTP synchronized: yes
RTC in local TZ: no
DST active: n/a
</code></pre>
<ul>
<li>如果安装系统时不开启 NTP，<code>chrony</code> 为后期安装，那 timedatectl 的输出如下。同时需要手动开启 NTP 同步，<code>NTP enabled: no</code> 才会变成 <code>yes</code>。</li>
</ul>
<pre><code>   &gt;root ~
[node1]# timedatectl
Local time: 六 2021-06-26 11:15:36 CST
Universal time: 六 2021-06-26 03:15:36 UTC
RTC time: 六 2021-06-26 03:15:36
Time zone: Asia/Shanghai (CST, +0800)
NTP enabled: no
NTP synchronized: no
RTC in local TZ: no
DST active: n/a
</code></pre>
<h4 id="date">date</h4>
<h5 id="此处省略">此处省略</h5>
<p>我感觉一行命令就可以了……「网上对于 <code>date</code> 命令的介绍很多」</p>
<pre><code>date +&quot;%Y-%m-%d %H:%M&quot;
</code></pre>
<h4 id="chrony">chrony</h4>
<p>Chrony 是一个 NTP 客户端的替代品。它可以更快地同步系统时钟，时间精度更高，对于一直不在线的系统尤其有用。chronyd 较小，它使用较少的内存，只在必要时才唤醒 CPU，这样可以更好地节省电能。即使网络拥塞较长时间，它也能很好地运行同步时间。它由两个程序组成，分别是 chronyd 和 chronyc。chronyd 是一个后台运行的守护进程，用于调整内核中运行的系统时钟和时钟服务器同步。它确定计算机增减时间的比率，并对此进行补偿。chronyc 提供了一个用户界面，用于监控性能并进行多样化的配置。</p>
<h5 id="安装-chrony-软件包">安装 chrony 软件包</h5>
<pre><code>yum install -y chrony
</code></pre>
<h5 id="修改配置">修改配置</h5>
<pre><code># controller
- server *
+ server 127.127.1.0 iburst
+ allow 192.168.10.0/24

# node
- server *
+ server controller iburst
</code></pre>
<h5 id="启动服务并设置开机自启动">启动服务，并设置开机自启动</h5>
<pre><code>systemctl start chronyd &amp;&amp; systemctl enable chronyd
</code></pre>
<h4 id="ntp">ntp</h4>
<h5 id="安装-ntp-软件包">安装 ntp 软件包</h5>
<pre><code class="language-shell">  yum -y install ntp
</code></pre>
<h5 id="备份配置">备份配置</h5>
<pre><code class="language-shell"># 配置各节点 ntpd 配置文件
  cp /etc/ntp.conf{,.bak}
</code></pre>
<h5 id="修改配置-1">修改配置</h5>
<pre><code class="language-shell"># 管理节点使用本地时钟源,执行以下语句即可
  cat &lt;&lt;EOF&gt;/etc/ntp.conf
  driftfile /var/lib/ntp/drift
  restrict default kod nomodify notrap nopeer noquery
  restrict -6 default kod nomodify notrap nopeer noquery
  restrict 127.0.0.1
  restrict -6 ::1
  server 127.127.1.0 iburst
  includefile /etc/ntp/crypto/pw
  keys /etc/ntp/keys
  EOF

# 其他节点的时钟源为管理节点，执行以下语句即可
  cat &lt;&lt;EOF&gt;/etc/ntp.conf
  driftfile /var/lib/ntp/drift
  restrict default kod nomodify notrap nopeer noquery
  restrict -6 default kod nomodify notrap nopeer noquery
  restrict 127.0.0.1
  restrict -6 ::1
  server node1  iburst
  includefile /etc/ntp/crypto/pw
  keys /etc/ntp/keys
  EOF
</code></pre>
<p>手动设置时间，写入硬件时钟</p>
<p>「CentOS 7 务必使用 <code>timedatectl</code> 来操作」</p>
<pre><code class="language-shell"># 修改各节点时间,时间为当前时间
  date -s &quot;2019-11-30 16:07:00&quot;
# 写入硬件时钟
  hwclock -w
</code></pre>
<h5 id="启动服务并设置开机自启动-1">启动服务，并设置开机自启动</h5>
<pre><code class="language-shell"># 各节点启动服务
  systemctl start ntpd

# 各节点设置开机自启动
  systemctl enable ntpd
</code></pre>
<h2 id="手动配置时钟">手动配置时钟</h2>
<p>手动配置完时钟后一定要同步到硬件时钟里</p>
<pre><code>timedatectl set-time &quot;20:01:09&quot;
</code></pre>
<pre><code>date -s &quot;20:01:09&quot;
</code></pre>
<h2 id="时钟同步状态校验">时钟同步状态校验</h2>
<ul>
<li>timedatectl</li>
</ul>
<pre><code>timedatectl status

  &gt;root ~
[node1]#  timedatectl status
   Local time: 二 2021-06-29 16:47:25 CST
   Universal time: 二 2021-06-29 08:47:25 UTC
   RTC time: 二 2021-06-29 08:47:25
   Time zone: Asia/Shanghai (CST, +0800)
   NTP enabled: yes
   NTP synchronized: yes
   RTC in local TZ: no
   DST active: n/a
</code></pre>
<ul>
<li>chrony</li>
</ul>
<pre><code>chronyc sources -v
chronyc tracking


  &gt;root ~
[node1]# chronyc sources -v
210 Number of sources = 4

 .-- Source mode  '^' = server, '=' = peer, '#' = local clock.
/ .- Source state '*' = current synced, '+' = combined , '-' = not combined,
| /   '?' = unreachable, 'x' = time may be in error, '~' = time too variable.
||                                                 .- xxxx [ yyyy ] +/- zzzz
||      Reachability register (octal) -.           |  xxxx = adjusted offset,
||      Log2(Polling interval) --.      |          |  yyyy = measured offset,
||                                \     |          |  zzzz = estimated error.
||                                 |    |           \
MS Name/IP address         Stratum Poll Reach LastRx Last sample
===============================================================================
^- tock.ntp.infomaniak.ch        1  10   377   22m    +12ms[  +12ms] +/-  104ms
^* 120.25.115.20                 2  10   377   307   +423us[ +432us] +/-   18ms
^- ntp1.flashdance.cx            2  10   377   664  +8908us[+8917us] +/-  154ms
^+ 119.28.183.184                2  10   337   884   -462us[ -453us] +/-   32ms
</code></pre>
<ul>
<li>ntp</li>
</ul>
<pre><code>ntpq -p
ntpstat
</code></pre>
<h2 id="参考资料">参考资料</h2>
<p><a href="https://www.iamhippo.com/2020-01/1306.html">https://www.iamhippo.com/2020-01/1306.html</a>
<a href="https://blog.csdn.net/weixin_34270606/article/details/91881851">https://blog.csdn.net/weixin_34270606/article/details/91881851</a>
<a href="https://ywnz.com/linuxml/5215.html">https://ywnz.com/linuxml/5215.html</a>
<a href="https://www.cnblogs.com/opsprobe/p/13779933.html">https://www.cnblogs.com/opsprobe/p/13779933.html</a></p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Since Ubuntu 16.04 timedatectl / timesyncd (which are part of systemd) replace most of ntpdate / ntp. @ <a href="https://ubuntu.com/server/docs/network-ntp">https://ubuntu.com/server/docs/network-ntp</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

    </div>
    <div class="article-footer">
<blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接: </strong>
      <a href="https://blog.standuke.top/2021/06/2021-06-26-linux-%E6%97%B6%E9%97%B4%E5%85%A8%E8%A7%A3/" title="Linux 时间全解" target="_blank" rel="external">https://blog.standuke.top/2021/06/2021-06-26-linux-%E6%97%B6%E9%97%B4%E5%85%A8%E8%A7%A3/</a>
    </li>
    <li class="post-copyright-license">
      <strong>License: </strong>
        <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN</a>
    </li>
  </ul>
</blockquote>

<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://www.standuke.top" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="https://blog.standuke.top/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://www.standuke.top" target="_blank"><span class="text-dark">Standuke</span><small class="ml-1x">Yunshen Technology Co., Ltd. - SRE Engineer</small></a></h3>
        <div>Focus on Linux Openstack Kubernetes vSphere Photograph Coding</div>
      </div>
    </figure>
  </div>
</div>

    </div>
  </article>
<section id="comments">
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
</section>

</div><nav class="bar bar-footer clearfix" data-stick-bottom>
    <div class="bar-inner">
        <ul class="pager pull-left">
            <li class="prev">
                <a href="https://blog.standuke.top/2021/05/2021-05-19-%E9%98%BF%E9%87%8C%E4%BA%91%E4%B8%BB%E6%9C%BA-eip-%E8%87%B4%E4%BD%BF-ftp-%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5/" title="阿里云主机 EIP 致使 FTP 无法连接"><i
                        class="icon icon-angle-left"
                        aria-hidden="true"></i><span>&nbsp;&nbsp;下一篇</span></a>
            </li>
            <li class="next">
                <a href="https://blog.standuke.top/2021/07/2021-07-06-linux-%E5%AE%9A%E6%97%B6%E5%8D%95%E6%AC%A1%E5%8F%8A%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/"
                    title="Linux 定时单次及周期任务"><span>上一篇&nbsp;&nbsp;</span><i
                        class="icon icon-angle-right" aria-hidden="true"></i></a>
            </li>
            
            <li class="toggle-toc">
                <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false"
                    title="文章目录" role="button">
                    <span>[&nbsp;</span><span>文章目录</span>
                    <i class="text-collapsed icon icon-anchor"></i>
                    <i class="text-in icon icon-close"></i>
                    <span>]</span>
                </a>
            </li>
        </ul>
        <div class="bar-right">
            <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter,google,linkedin"
                data-mobile-sites="wechat,qq,facebook,twitter"></div>
        </div>
    </div>
</nav>


</main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
<ul class="social-links">
    <li><a href="https://github.com/idoker" target="_blank" title="github" data-toggle=tooltip data-placement=top >
            <i class="icon icon-github"></i></a></li>
    <li><a href="https://blog.standuke.top/index.xml" target="_blank" title="rss" data-toggle=tooltip data-placement=top >
            <i class="icon icon-rss"></i></a></li>
</ul>
  <div class="copyright">
    &copy;2016  -
    2024
    <div class="publishby">
        Theme by <a href="https://github.com/xiaoheiAh" target="_blank"> xiaoheiAh </a>base on<a href="https://github.com/xiaoheiAh/hugo-theme-pure" target="_blank"> pure</a>.
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script>
    window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/shell.min.js" defer></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/python.min.js" defer></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/javascript.min.js" defer></script><script>
    hljs.configure({
        tabReplace: '    ', 
        classPrefix: ''     
        
    })
    hljs.initHighlightingOnLoad();
</script>
<script src="https://blog.standuke.top/js/application.min.a94ab19cb63a95c8d7fbd7b85cab3ddeea8c369bdf75b9cab6708787ead123af.js"></script>
<script src="https://blog.standuke.top/js/plugin.min.19c5bcb2fb0789ab4f2b7834e5ceb5e92635645605bab902c1024b25f1502364.js"></script>

<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(未命名)',
            },
            ROOT_URL: 'https:\/\/blog.standuke.top\/',
            CONTENT_URL: 'https:\/\/blog.standuke.top\/\/searchindex.json ',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script type="text/javascript" src="https://blog.standuke.top/js/insight.min.4a2d52de4bfff73e0c688404fe3d17c9a3ae12d9888e1e1ac9c690e4890de2ded50fe55f2b819c2ba55435a76f396f3ea6805765f0b0af5635cdf74ea459eab0.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<script>
    tocbot.init({
        
        tocSelector: '.js-toc',
        
        contentSelector: '.js-toc-content',
        
        headingSelector: 'h1, h2, h3',
        
        hasInnerContainers: true,
    });
</script>

<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script>
    var disqus_config = function () {
        this.page.url = 'https:\/\/blog.standuke.top\/2021\/06\/2021-06-26-linux-%E6%97%B6%E9%97%B4%E5%85%A8%E8%A7%A3\/';
        <!-- this.page.identifier = 'nuo'; -->
    };
    (function () {
        var d = document, s = d.createElement('script');
        s.src = '//' + 'nuo' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-180157250-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
